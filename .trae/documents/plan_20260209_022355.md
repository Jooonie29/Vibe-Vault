# Browser Extension for Vault Vibe

This plan outlines the creation of a Chrome/Edge browser extension that integrates with your existing Vault Vibe application. The extension will allow users to easily save prompts, code snippets, and helpful text from any webpage directly into their Vibe Vault library.

## 1. Extension Architecture

* **Tech Stack:** React, Vite, TypeScript, Tailwind CSS (matching your web app).

* **Backend:** Direct connection to your existing Convex backend.

* **Authentication:** Clerk (leveraging your existing `ClerkProvider` setup).

* **Manifest Version:** V3 (current standard).

## 2. Key Functionalities

### A. Authentication & Sync

* **Unified Login:** Users log in via the extension popup using their existing Vault Vibe credentials (via Clerk).

* **Team Sync:** The extension will fetch the user's available teams, allowing them to save items to their personal library or a specific team workspace.

### B. "Right-Click" Context Menu

* **"Save to Vault":** A context menu item appears when a user selects text on any webpage.

* **Smart Detection:** The extension will attempt to auto-detect if the selected text is code or a prompt based on the HTML tags (e.g., inside `<pre>` or `<code>` blocks) or content patterns.

### C. Extension Popup

* **Quick Add Form:** A clean interface to manually add an item.

  * **Fields:** Title, Content (auto-filled from selection), Type (Code/Prompt), Language (for code), Team/Personal selector.

* **Recent Saves:** A list of the last few items saved, with links to open them in the main web app.

* **Search:** A mini-search bar to quickly find existing prompts/snippets without opening the full web app.

### D. Page Injection (Optional/Advanced)

* **Code Block Actions:** Automatically inject a small "Save to Vault" button next to code blocks on popular developer sites like StackOverflow, GitHub, and ChatGPT.

## 3. Implementation Plan

### Phase 1: Project Initialization

1. **Scaffold Extension:** Create a new directory `extension` within your repo (or a separate repo) with a Vite + React template.
2. **Manifest Configuration:** Create `manifest.json` with permissions for `contextMenus`, `storage`, `activeTab`, and `scripting`.
3. **Build Setup:** Configure Vite to output a browser-compatible extension build (using plugins like `@crxjs/vite-plugin` is recommended for hot-reload during dev).

### Phase 2: Authentication (Clerk + Convex)

1. **Auth Flow:** Implement Clerk authentication in the extension. This typically involves a "Login" button in the popup that opens a tab to your web app to authenticate, then passes the session token back to the extension.
2. **Convex Client:** Initialize a `ConvexReactClient` in the extension popup using the same `VITE_CONVEX_URL` from your main app.
3. **Token Forwarding:** Ensure the Convex client in the extension uses the Clerk token for all requests to respect your RLS (Row Level Security) rules.

### Phase 3: Core Features

1. **Context Menu Logic:**

   * Create a background script (`background.ts`) to handle `chrome.contextMenus.onClicked`.

   * When clicked, open the popup (or a side panel) with the selected text pre-filled.
2. **Popup UI:**

   * Build the "Add Item" form reusing your existing UI components (Inputs, Buttons) where possible to maintain brand consistency.

   * Implement the `useMutation` calls to `api.items.createItem`.

### Phase 4: Polish & Publish

1. **Toast Notifications:** Show success/error messages within the webpage context using content scripts.
2. **Testing:** Verify auth persistence, team selection, and saving across different websites.
3. **Packaging:** Build and zip the extension for the Chrome Web Store.

## 4. Next Steps

If you approve this plan, I can start by **creating the basic scaffold for the extension** in a new folder structure and setting up the manifest file. We will treat this as a sub-project within your current repository.
